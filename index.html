<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Checador de Asistencia</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f4f4f9; }
    button { padding: 12px 24px; font-size: 16px; margin: 10px; border: none; border-radius: 8px; background: #4CAF50; color: white; cursor: pointer; }
    button:hover { background: #45a049; }
    .card { border: 1px solid #ccc; border-radius: 10px; padding: 20px; margin-top: 20px; background: white; box-shadow: 0px 4px 6px rgba(0,0,0,0.1); text-align: left; }
    input { padding: 10px; border-radius: 6px; border: 1px solid #ccc; width: 250px; }
    #download-link { display: none; margin-top: 10px; padding: 10px 20px; background: #007BFF; color: white; border-radius: 5px; text-decoration: none; }
  </style>
</head>
<body>
  <h1>ğŸ“ Checador de Asistencia</h1>
  <p>Ingresa tu nombre y registra tu asistencia</p>

  <input type="text" id="docente" placeholder="Ejemplo: Juan PÃ©rez"><br><br>
  <button onclick="registrar('inicio')">â–¶ï¸ Iniciar Clase / Jornada</button>
  <button onclick="registrar('fin')">â¹ï¸ Finalizar Clase / Jornada</button>
  
  <div id="resultado" class="card"></div>

  <script type="module">
    // Importar SDKs de Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import html2canvas from "https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js";

    // ğŸ”¹ Pega aquÃ­ tu configuraciÃ³n de Firebase
    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_PROYECTO.firebaseapp.com",
      projectId: "TU_PROYECTO",
      storageBucket: "TU_PROYECTO.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:abcdef123456"
    };

    // Inicializar Firebase y Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Ejemplo de horarios
    const horarios = {
      "Juan PÃ©rez": { "lunes": "MatemÃ¡ticas 9:00-10:00 Aula 3", "martes": "FÃ­sica 10:00-11:00 Aula 2" },
      "MarÃ­a LÃ³pez": { "lunes": "Historia 11:00-12:00 Aula 1", "martes": "EspaÃ±ol 8:00-9:00 Aula 5" }
    };

    async function registrar(tipo) {
      const docente = document.getElementById("docente").value.trim();
      if (!docente) {
        alert("Por favor escribe tu nombre");
        return;
      }

      if (!navigator.geolocation) {
        alert("Tu navegador no soporta geolocalizaciÃ³n");
        return;
      }

      navigator.geolocation.getCurrentPosition(async pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        const hoy = new Date();
        const fecha = hoy.toISOString().split("T")[0];
        const hora = hoy.toLocaleTimeString("es-ES");
        const diaSemana = hoy.toLocaleDateString("es-ES", { weekday: "long" }).toLowerCase();
        const clase = horarios[docente]?.[diaSemana] || "Jornada / Sin clase asignada";
        
        const mensajeAlerta = tipo === 'inicio' ? 
          `âœ… Asistencia registrada. Â¡Clase iniciada!\n\nDocente: ${docente}\nClase: ${clase}` :
          `â¹ï¸ Asistencia registrada. Â¡Clase finalizada!\n\nDocente: ${docente}\nClase: ${clase}`;

        alert(mensajeAlerta); // AquÃ­ se agrega el aviso.

        const resultadoDiv = document.getElementById("resultado");
        resultadoDiv.innerHTML = `
          <p>
            ${tipo === 'inicio' ? "âœ… Clase/Jornada iniciada" : "â¹ï¸ Clase/Jornada finalizada"}<br>
            ğŸ‘¨â€ğŸ« Docente: <b>${docente}</b><br>
            ğŸ“… Fecha: ${fecha} (${diaSemana})<br>
            ğŸ•’ Hora: ${hora}<br>
            ğŸ“ UbicaciÃ³n: ${lat.toFixed(4)}, ${lon.toFixed(4)}<br>
            ğŸ“š Clase: ${clase}
          </p>
        `;

        // Guardar en Firestore
        await addDoc(collection(db, "asistencias"), {
          docente,
          tipo,
          fecha,
          hora,
          clase,
          lat,
          lon
        });

        // Tomar pantallazo del resultado
        html2canvas(resultadoDiv).then(canvas => {
          const image = canvas.toDataURL("image/png");
          const link = document.createElement('a');
          link.href = image;
          link.download = `asistencia_${docente}_${fecha}.png`;
          link.click();
        });

      }, () => {
        alert("No se pudo obtener la ubicaciÃ³n");
      });
    }

    // Exponer funciÃ³n al HTML
    window.registrar = registrar;
  </script>
</body>
</html>